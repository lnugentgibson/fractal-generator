"use strict";var _slicedToArray=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_window=window,angular=_window.angular,$=_window.$;angular.module("oaBlenderInput",["oaValidators"]).constant("ConfigStates",["none","edit","down","drag","fromdrag"]).service("oaBlenderInputDocumentState",["ConfigStates",function(a){function b(){var a,b,c,d,e,f,g,h,i=!1,j=function(a){var b=Date.now();f=a.pageX-c,g=a.pageY-d,h=b-e,c=a.pageX,d=a.pageY,e=b},k=function(a,b){b.prevstate!==b.state&&i&&console.log("click from state "+b.prevstate+" to "+b.state)};this.overlayClick=function(a,b,c){var d=a.find(".oa-bnumber-field");j(c),b.prevstate=b.state,"drag"!==b.state&&"fromdrag"!==b.state&&(b.state="edit",a.addClass("oa-edit-mode"),d.select(),d.focus()),"fromdrag"===b.state&&(b.state="none"),k("click",b)},this.overlayDown=function(c,d,e){c.controller("ng-model");j(e),d.prevstate=d.state,d.state="down",a=c,b=d,d["float"]=d.value,k("down",d)},this.documentUp=function(c){a&&(b.prevstate=b.state,j(c),b.state="drag"===b.state?"fromdrag":"none",k("up",b))},this.documentMove=function(c){if(a){var d=a.find(".oa-bnumber-field"),e=d.controller("ng-model");if(b.prevstate=b.state,j(c),"down"===b.state&&h>100&&(b.state="drag"),"drag"===b.state){if(c.preventDefault(),!b.stepSpec)return;var g=b.stepDec.mul(b.speedDec.mul(f)),i=b["float"];b["float"]=parseFloat(i)+new Number(g),b._value=b._float,b.ensureValid(),e.$setViewValue(b._value),e.$render()}k("move",b)}},this.fieldBlur=function(a,b,c){a.find(".oa-bnumber-field");j(c),b.prevstate=b.state,a.removeClass("oa-edit-mode"),b.state="none",b.ensureValid(),k("blur",b)},this.decrement=function(a,b,c){c.preventDefault();a.find(".oa-bnumber-field");j(c),b.prevstate=b.state,b.decrement(),k("dec",b)},this.increment=function(a,b,c){c.preventDefault();a.find(".oa-bnumber-field");j(c),b.prevstate=b.state;b.value;b.increment(),k("inc",b)},$(document).mouseup(this.documentUp),$(document).mousemove(this.documentMove)}return new b}]).factory("oaNumberElement",["ConfigStates","oaNumber",function(a,b){function c(c,d){var e=this;b.call(e,c,d),e.sourceProperty(e,c,"previousstate",null,function(b){return a[b]},function(b){return a.indexOf(b)}),e.sourceProperty(e,c,"state",null,function(b){return a[b]},function(b){return a.indexOf(b)}),e.state="none",e.numberProperty(e,c,"speed"),e.speed=1,e.genProperty(e,c,"label"),e.genProperty(e,c,"fieldname"),e.numberProperty(e,c,"float")}return c}]).directive("oaBnumberset",["oaBlenderInputDocumentState","oaNumberElement",function(a,b){function c(){}function d(c,d,e,f){var g,h=_slicedToArray(f,2),i=(h[0],h[1]);c.state="none",c.states=[],c.values=[];var j=c.elements=[];for(c.length=parseInt(e.length,10),console.log(c),g=0;g<c.length;g++)!function(e){var f=$(d),g=j[e]=new b(c,e);console.log(g.toJSON()),g.onClick=function(b){a.overlayClick(f.find(".oa-bnumbers-element[data-element-index="+e+"]"),g,b)},g.onDown=function(b){a.overlayDown(f.find(".oa-bnumbers-element[data-element-index="+e+"]"),g,b)},g.onBlur=function(b){a.fieldBlur(f.find(".oa-bnumbers-element[data-element-index="+e+"]"),g,b)},g.onDecrement=function(b){a.decrement(f.find(".oa-bnumbers-element[data-element-index="+e+"]"),g,b)},g.onIncrement=function(b){a.increment(f.find(".oa-bnumbers-element[data-element-index="+e+"]"),g,b)}}(g);c.name=i.$name,i.$render=function(){i.$viewValue.forEach(function(a,b){j[b].value!=a&&(j[b].value=a)})},c.$watch("values",function(a,b){i.$setViewValue(j.map(function(a){return a._value}))},!0),i.$formatters.push(function(a){return a.map(function(a){return a.toString()})}),i.$parsers.push(function(a){return a.map(function(a){return parseFloat(a)})})}return{templateUrl:"oa-bnumberset-template",scope:{length:"@",fieldname:"@?",ngFieldname:"=?",ngFieldnames:"=?",label:"@?",ngLabel:"=?",ngLabels:"=?",required:"@?",ngRequired:"=?",ngRequireds:"=?",speed:"@?",ngSpeed:"=?",ngSpeeds:"=?",step:"@?",ngStep:"=?",ngSteps:"=?",basis:"@?",ngBasis:"=?",ngBases:"=?",min:"@?",ngMin:"=?",ngMins:"=?",max:"@?",ngMax:"=?",ngMaxs:"=?"},restrict:"E",require:["oaBnumberset","ngModel"],replace:!0,controllerAs:"ib",controller:c,link:d}}]);