"use strict";var _window=window,angular=_window.angular;angular.module("oaSylvester",["oaUtil"]).service("oaSylvester",["oaUtil",function(a){function b(b,c,d,e,g){var h=this;c=c||4,d=d||0,g=g||1,e=e||(b?b.byteLength/c:4);var i=((e-1)*g+1)*c;b||(b=new ArrayBuffer(d+i));var j;switch(c){case 4:j=new Float32Array(b,d,e);break;case 8:j=new Float64Array(e);break;default:console.log("invalid type: "+c)}for(var k={},l=0;e>l;l++)!function(a){var b={get:function(){return j[a*g]},set:function(b){j[a*g]=b}};Object.defineProperty(k,a,b),Object.defineProperty(h,a,b)}(l);var m={get:function(){return e}};Object.defineProperties(k,{length:m}),Object.defineProperties(this,{elements:{get:function(){return k}},length:m,dimensions:m,modulus:{get:function(){return Math.sqrt(h.dot(h))},set:function(a){var b=h.modulus;b>f.precision&&h.x(a/b)}}}),a.arrayFunctions.call(k)}function c(){}function d(){}function e(){}var f;b.prototype={e:function(a){return 1>a||a>this.elements.length?null:this.elements[a-1]},eql:function(a){var b=this.length;if(b!=a.length)return!1;do if(Math.abs(this[b-1]-a[b-1])>f.precision)return!1;while(--b);return!0},dup:function(){return b.create(this.elements)},map:function(a){return b.create(this.elements.map(function(b,c){return a(b,c+1)}))},each:function(a){this.elements.forEach(function(b,c){return a(b,c+1)})},toUnitVector:function(){var a=this.modulus();return 0===a?this.dup():this.map(function(b){return b/a})},angleFrom:function(a){if(this.length!=a.length)return null;var b=0,c=0,d=0;if(this.each(function(e,f){b+=e*a[f-1],c+=e*e,d+=a[f-1]*a[f-1]}),c=Math.sqrt(c),d=Math.sqrt(d),c*d===0)return null;var e=b/(c*d);return-1>e&&(e=-1),e>1&&(e=1),Math.acos(e)},isParallelTo:function(a){var b=this.angleFrom(a);return null===b?null:b<=f.precision},isAntiparallelTo:function(a){var b=this.angleFrom(a);return null===b?null:Math.abs(b-Math.PI)<=f.precision},isPerpendicularTo:function(a){var b=this.dot(a);return null===b?null:Math.abs(b)<=f.precision},sum:function(a){return this.length!=a.length?null:this.map(function(b,c){return b+a[c-1]})},s:function(a){return this.sum(a)},add:function(a){return this.length!=a.length?null:this.setElements(this.elements.map(function(b,c){return b+a[c-1]}))},a:function(a){return this.add(a)},difference:function(a){return this.length!=a.length?null:this.map(function(b,c){return b-a[c-1]})},d:function(a){return this.difference(a)},minus:function(a){return this.length!=a.length?null:this.setElements(this.elements.map(function(b,c){return b-a[c-1]}))},m:function(a){return this.minus(a)},product:function(a){return this.map(function(b){return b*a})},p:function(a){return this.product(a)},multiply:function(a){return this.setElements(this.elements.map(function(b){return b*a}))},x:function(a){return this.multiply(a)},dot:function(a){return this.length!=a.length?null:this.elements.reduce(function(b,c,d){return b+c*a[d]},0)},cross:function(a){var c=a.elements||a;if(3!=this.length||3!=c.length)return null;var d=this.elements;return b.create([d[1]*c[2]-d[2]*c[1],d[2]*c[0]-d[0]*c[2],d[0]*c[1]-d[1]*c[0]])},max:function(){return this.elements.reduce(function(a,b){return a>Math.abs(b)?a:Math.abs(b)},Math.abs(this[0]))},indexOf:function(a){var b,c=null,d=this.elements.length,e=d;do b=e-d,null===c&&this.elements[b]==a&&(c=b+1);while(--d);return c},toDiagonalMatrix:function(){return c.Diagonal(this.elements)},round:function(){return this.map(function(a){return Math.round(a)})},snapTo:function(a){return this.map(function(b){return Math.abs(b-a)<=f.precision?a:b})},distanceFrom:function(a){if(a.anchor)return a.distanceFrom(this);var b=a.elements||a;if(b.length!=this.elements.length)return null;var c,d=0;return this.each(function(a,e){c=a-b[e-1],d+=c*c}),Math.sqrt(d)},liesOn:function(a){return a.contains(this)},liesIn:function(a){return a.contains(this)},rotate:function(a,d){var e,f,g,h,i;switch(this.elements.length){case 2:return e=d.elements||d,2!=e.length?null:(f=c.Rotation(a).elements,g=this.elements[0]-e[0],h=this.elements[1]-e[1],b.create([e[0]+f[0][0]*g+f[0][1]*h,e[1]+f[1][0]*g+f[1][1]*h]));case 3:if(!d.direction)return null;var j=d.pointClosestTo(this).elements;return f=c.Rotation(a,d.direction).elements,g=this.elements[0]-j[0],h=this.elements[1]-j[1],i=this.elements[2]-j[2],b.create([j[0]+f[0][0]*g+f[0][1]*h+f[0][2]*i,j[1]+f[1][0]*g+f[1][1]*h+f[1][2]*i,j[2]+f[2][0]*g+f[2][1]*h+f[2][2]*i]);default:return null}},reflectionIn:function(a){if(a.anchor){var c=this.elements.slice(),d=a.pointClosestTo(c).elements;return b.create([d[0]+(d[0]-c[0]),d[1]+(d[1]-c[1]),d[2]+(d[2]-(c[2]||0))])}var e=a.elements||a;return this.elements.length!=e.length?null:this.map(function(a,b){return e[b-1]+(e[b-1]-a)})},to3D:function(){var a=this.dup();switch(a.elements.length){case 3:break;case 2:a.elements.push(0);break;default:return null}return a},inspect:function(){return"["+this.elements.join(", ")+"]"},setElements:function(a){for(var b=0;b<this.length&&b<a.length;b++)this[b]=a[b];return this}},b.create=function(a){var c=new b(null,4,0,a.length,1);return c.setElements(a)},b.fromBuffer=function(a,c,d,e,f){var g=new b(a,c,d,e,f);return g},b.x2=b.create([1,0]),b.y2=b.create([0,1]),b.i=b.x3=b.create([1,0,0]),b.j=b.y3=b.create([0,1,0]),b.k=b.z3=b.create([0,0,1]),b.x4=b.create([1,0,0,0]),b.y4=b.create([0,1,0,0]),b.z4=b.create([0,0,1,0]),b.w4=b.create([0,0,0,1]),b.Random=function(a){var c=[];do c.push(Math.random());while(--a);return b.create(c)},b.Zero=function(a){var c=[];do c.push(0);while(--a);return b.create(c)},b.o2=b.Zero(2),b.o3=b.Zero(3),b.o4=b.Zero(4),c.prototype={e:function(a,b){return 1>a||a>this.elements.length||1>b||b>this.elements[0].length?null:this.elements[a-1][b-1]},row:function(a){return a>this.elements.length?null:b.create(this.elements[a-1])},col:function l(a){if(a>this.elements[0].length)return null;var c,l=[],d=this.elements.length,e=d;do c=e-d,l.push(this.elements[c][a-1]);while(--d);return b.create(l)},dimensions:function(){return{rows:this.elements.length,cols:this.elements[0].length}},rows:function(){return this.elements.length},cols:function(){return this.elements[0].length},eql:function(a){var b=a.elements||a;if("undefined"==typeof b[0][0]&&(b=c.create(b).elements),this.elements.length!=b.length||this.elements[0].length!=b[0].length)return!1;var d,e,g,h=this.elements.length,i=h,j=this.elements[0].length;do{d=i-h,e=j;do if(g=j-e,Math.abs(this.elements[d][g]-b[d][g])>f.precision)return!1;while(--e)}while(--h);return!0},dup:function(){return c.create(this.elements)},map:function(a){var b,d,e,f=[],g=this.elements.length,h=g,i=this.elements[0].length;do{b=h-g,d=i,f[b]=[];do e=i-d,f[b][e]=a(this.elements[b][e],b+1,e+1);while(--d)}while(--g);return c.create(f)},isSameSizeAs:function(a){var b=a.elements||a;return"undefined"==typeof b[0][0]&&(b=c.create(b).elements),this.elements.length==b.length&&this.elements[0].length==b[0].length},add:function(a){var b=a.elements||a;return"undefined"==typeof b[0][0]&&(b=c.create(b).elements),this.isSameSizeAs(b)?this.map(function(a,c,d){return a+b[c-1][d-1]}):null},a:function(a){return this.add(a)},subtract:function(a){var b=a.elements||a;return"undefined"==typeof b[0][0]&&(b=c.create(b).elements),this.isSameSizeAs(b)?this.map(function(a,c,d){return a-b[c-1][d-1]}):null},s:function(a){return this.subtract(a)},canMultiplyFromLeft:function(a){var b=a.elements||a;return"undefined"==typeof b[0][0]&&(b=c.create(b).elements),this.elements[0].length==b.length},multiply:function(a){if(!a.elements)return this.map(function(b){return b*a});var b=a.modulus?!0:!1,d=a.elements||a;if("undefined"==typeof d[0][0]&&(d=c.create(d).elements),!this.canMultiplyFromLeft(d))return null;var e,f,g,h,i,j,k=this.elements.length,l=k,m=d[0].length,n=this.elements[0].length,o=[];do{e=l-k,o[e]=[],f=m;do{g=m-f,h=0,i=n;do j=n-i,h+=this.elements[e][j]*d[j][g];while(--i);o[e][g]=h}while(--f)}while(--k);var d=c.create(o);return b?d.col(1):d},x:function(a){return this.multiply(a)},minor:function(a,b,d,e){var f,g,h,i=[],j=d,k=this.elements.length,l=this.elements[0].length;do{f=d-j,i[f]=[],g=e;do h=e-g,i[f][h]=this.elements[(a+f-1)%k][(b+h-1)%l];while(--g)}while(--j);return c.create(i)},transpose:function(){var a,b,d,e=this.elements.length,f=this.elements[0].length,g=[],h=f;do{a=f-h,g[a]=[],b=e;do d=e-b,g[a][d]=this.elements[d][a];while(--b)}while(--h);return c.create(g)},isSquare:function(){return this.elements.length==this.elements[0].length},max:function(){var a,b,c,d=0,e=this.elements.length,f=e,g=this.elements[0].length;do{a=f-e,b=g;do c=g-b,Math.abs(this.elements[a][c])>Math.abs(d)&&(d=this.elements[a][c]);while(--b)}while(--e);return d},indexOf:function(a){var b,c,d,e=this.elements.length,f=e,g=this.elements[0].length;do{b=f-e,c=g;do if(d=g-c,this.elements[b][d]==a)return{i:b+1,j:d+1};while(--c)}while(--e);return null},diagonal:function(){if(!this.isSquare)return null;var a,c=[],d=this.elements.length,e=d;do a=e-d,c.push(this.elements[a][a]);while(--d);return b.create(c)},toRightTriangular:function(){var a,b,c,d,e=this.dup(),f=this.elements.length,g=f,h=this.elements[0].length;do{if(b=g-f,0==e.elements[b][b])for(j=b+1;j<g;j++)if(0!=e.elements[j][b]){a=[],c=h;do d=h-c,a.push(e.elements[b][d]+e.elements[j][d]);while(--c);e.elements[b]=a;break}if(0!=e.elements[b][b])for(j=b+1;j<g;j++){var i=e.elements[j][b]/e.elements[b][b];a=[],c=h;do d=h-c,a.push(b>=d?0:e.elements[j][d]-e.elements[b][d]*i);while(--c);e.elements[j]=a}}while(--f);return e},toUpperTriangular:function(){return this.toRightTriangular()},determinant:function(){if(!this.isSquare())return null;var a,b=this.toRightTriangular(),c=b.elements[0][0],d=b.elements.length-1,e=d;do a=e-d+1,c*=b.elements[a][a];while(--d);return c},det:function(){return this.determinant()},isSingular:function(){return this.isSquare()&&0===this.determinant()},trace:function(){if(!this.isSquare())return null;var a,b=this.elements[0][0],c=this.elements.length-1,d=c;do a=d-c+1,b+=this.elements[a][a];while(--c);return b},tr:function(){return this.trace()},rank:function m(){var a,b,c,d=this.toRightTriangular(),m=0,e=this.elements.length,g=e,h=this.elements[0].length;do{a=g-e,b=h;do if(c=h-b,Math.abs(d.elements[a][c])>f.precision){m++;break}while(--b)}while(--e);return m},rk:function(){return this.rank()},augment:function(a){var b=a.elements||a;"undefined"==typeof b[0][0]&&(b=c.create(b).elements);var d,e,f,g=this.dup(),h=g.elements[0].length,i=g.elements.length,j=i,k=b[0].length;if(i!=b.length)return null;do{d=j-i,e=k;do f=k-e,g.elements[d][h+f]=b[d][f];while(--e)}while(--i);return g},inverse:function(){if(!this.isSquare()||this.isSingular())return null;var a,b,d,e,f,g,h,i=this.elements.length,j=i,k=this.augment(c.I(i)).toRightTriangular(),l=k.elements[0].length,m=[];do{a=i-1,f=[],d=l,m[a]=[],g=k.elements[a][a];do e=l-d,h=k.elements[a][e]/g,f.push(h),e>=j&&m[a].push(h);while(--d);for(k.elements[a]=f,b=0;a>b;b++){f=[],d=l;do e=l-d,f.push(k.elements[b][e]-k.elements[a][e]*k.elements[b][a]);while(--d);k.elements[b]=f}}while(--i);return c.create(m)},inv:function(){return this.inverse()},round:function(){return this.map(function(a){return Math.round(a)})},snapTo:function(a){return this.map(function(b){return Math.abs(b-a)<=f.precision?a:b})},inspect:function(){var a,c=[],d=this.elements.length,e=d;do a=e-d,c.push(b.create(this.elements[a]).inspect());while(--d);return c.join("\n")},setSource:function(a,b,c,d,e,f){return this.elements=a,this.m=b,this.n=c,this.offset=d||0,this.skip1=e||1,this.skip2=e||c,this},setElements:function(a){var b,c;if("undefined"!=typeof a[0][0]){for(b=0;b<a.length&&b<this.m;b++)for(c=0;c<a[0].length&&c<this.n;c++)this.elements[b*this.n+c]=a[b][c];return this}for(b=0;b<a.length&&b<this.m*this.n;b++)this.elements[b]=a[b]}},c.create=function(a){var b=new c;return b.setElements(a)},c.I=function(a){var b,d,e,f=[],g=a;do{b=g-a,f[b]=[],d=g;do e=g-d,f[b][e]=b==e?1:0;while(--d)}while(--a);return c.create(f)},c.Diagonal=function(a){var b,d=a.length,e=d,f=c.I(d);do b=e-d,f.elements[b][b]=a[b];while(--d);return f},c.Rotation=function(a,b){if(!b)return c.create([[Math.cos(a),-Math.sin(a)],[Math.sin(a),Math.cos(a)]]);var d=b.dup();if(3!=d.elements.length)return null;var e=d.modulus(),f=d.elements[0]/e,g=d.elements[1]/e,h=d.elements[2]/e,i=Math.sin(a),j=Math.cos(a),k=1-j;return c.create([[k*f*f+j,k*f*g-i*h,k*f*h+i*g],[k*f*g+i*h,k*g*g+j,k*g*h-i*f],[k*f*h-i*g,k*g*h+i*f,k*h*h+j]])},c.RotationX=function(a){var b=Math.cos(a),d=Math.sin(a);return c.create([[1,0,0],[0,b,-d],[0,d,b]])},c.RotationY=function(a){var b=Math.cos(a),d=Math.sin(a);return c.create([[b,0,d],[0,1,0],[-d,0,b]])},c.RotationZ=function(a){var b=Math.cos(a),d=Math.sin(a);return c.create([[b,-d,0],[d,b,0],[0,0,1]])},c.Random=function(a,b){return c.Zero(a,b).map(function(){return Math.random()})},c.Zero=function(a,b){var d,e,f,g=[],h=a;do{d=a-h,g[d]=[],e=b;do f=b-e,g[d][f]=0;while(--e)}while(--h);return c.create(g)},d.prototype={eql:function(a){return this.isParallelTo(a)&&this.contains(a.anchor)},dup:function(){return d.create(this.anchor,this.direction)},translate:function(a){var b=a.elements||a;return d.create([this.anchor.elements[0]+b[0],this.anchor.elements[1]+b[1],this.anchor.elements[2]+(b[2]||0)],this.direction)},isParallelTo:function(a){if(a.normal)return a.isParallelTo(this);var b=this.direction.angleFrom(a.direction);return Math.abs(b)<=f.precision||Math.abs(b-Math.PI)<=f.precision},distanceFrom:function(a){if(a.normal)return a.distanceFrom(this);if(a.direction){if(this.isParallelTo(a))return this.distanceFrom(a.anchor);var b=this.direction.cross(a.direction).toUnitVector().elements,c=this.anchor.elements,d=a.anchor.elements;return Math.abs((c[0]-d[0])*b[0]+(c[1]-d[1])*b[1]+(c[2]-d[2])*b[2])}var e=a.elements||a,c=this.anchor.elements,f=this.direction.elements,g=e[0]-c[0],h=e[1]-c[1],i=(e[2]||0)-c[2],j=Math.sqrt(g*g+h*h+i*i);if(0===j)return 0;var k=(g*f[0]+h*f[1]+i*f[2])/j,l=1-k*k;return Math.abs(j*Math.sqrt(0>l?0:l))},contains:function(a){var b=this.distanceFrom(a);return null!==b&&b<=f.precision},liesIn:function(a){return a.contains(this)},intersects:function(a){return a.normal?a.intersects(this):!this.isParallelTo(a)&&this.distanceFrom(a)<=f.precision},intersectionWith:function(a){if(a.normal)return a.intersectionWith(this);if(!this.intersects(a))return null;var c=this.anchor.elements,d=this.direction.elements,e=a.anchor.elements,f=a.direction.elements,g=d[0],h=d[1],i=d[2],j=f[0],k=f[1],l=f[2],m=c[0]-e[0],n=c[1]-e[1],o=c[2]-e[2],p=-g*m-h*n-i*o,q=j*m+k*n+l*o,r=g*g+h*h+i*i,s=j*j+k*k+l*l,t=g*j+h*k+i*l,u=(p*s/r+t*q)/(s-t*t);return b.create([c[0]+u*g,c[1]+u*h,c[2]+u*i])},pointClosestTo:function(a){if(a.direction){if(this.intersects(a))return this.intersectionWith(a);if(this.isParallelTo(a))return null;var c=this.direction.elements,d=a.direction.elements,f=c[0],g=c[1],h=c[2],i=d[0],j=d[1],k=d[2],l=h*i-f*k,m=f*j-g*i,n=g*k-h*j,o=b.create([l*k-m*j,m*i-n*k,n*j-l*i]),p=e.create(a.anchor,o);return p.intersectionWith(this)}var p=a.elements||a;if(this.contains(p))return b.create(p);var q=this.anchor.elements,c=this.direction.elements,f=c[0],g=c[1],h=c[2],r=q[0],s=q[1],t=q[2],l=f*(p[1]-s)-g*(p[0]-r),m=g*((p[2]||0)-t)-h*(p[1]-s),n=h*(p[0]-r)-f*((p[2]||0)-t),u=b.create([g*l-h*n,h*m-f*l,f*n-g*m]),v=this.distanceFrom(p)/u.modulus();return b.create([p[0]+u.elements[0]*v,p[1]+u.elements[1]*v,(p[2]||0)+u.elements[2]*v])},rotate:function(a,e){"undefined"==typeof e.direction&&(e=d.create(e.to3D(),b.k));var f=c.Rotation(a,e.direction).elements,g=e.pointClosestTo(this.anchor).elements,h=this.anchor.elements,i=this.direction.elements,j=g[0],k=g[1],l=g[2],m=h[0],n=h[1],o=h[2],p=m-j,q=n-k,r=o-l;return d.create([j+f[0][0]*p+f[0][1]*q+f[0][2]*r,k+f[1][0]*p+f[1][1]*q+f[1][2]*r,l+f[2][0]*p+f[2][1]*q+f[2][2]*r],[f[0][0]*i[0]+f[0][1]*i[1]+f[0][2]*i[2],f[1][0]*i[0]+f[1][1]*i[1]+f[1][2]*i[2],f[2][0]*i[0]+f[2][1]*i[1]+f[2][2]*i[2]])},reflectionIn:function(a){if(a.normal){var b=this.anchor.elements,c=this.direction.elements,e=b[0],f=b[1],g=b[2],h=c[0],i=c[1],j=c[2],k=this.anchor.reflectionIn(a).elements,l=e+h,m=f+i,n=g+j,o=a.pointClosestTo([l,m,n]).elements,p=[o[0]+(o[0]-l)-k[0],o[1]+(o[1]-m)-k[1],o[2]+(o[2]-n)-k[2]];return d.create(k,p)}if(a.direction)return this.rotate(Math.PI,a);var q=a.elements||a;return d.create(this.anchor.reflectionIn([q[0],q[1],q[2]||0]),this.direction)},setVectors:function(a,c){if(a=b.create(a),c=b.create(c),2==a.elements.length&&a.elements.push(0),2==c.elements.length&&c.elements.push(0),a.elements.length>3||c.elements.length>3)return null;var d=c.modulus();return 0===d?null:(this.anchor=a,this.direction=b.create([c.elements[0]/d,c.elements[1]/d,c.elements[2]/d]),this)}},d.create=function(a,b){var c=new d;return c.setVectors(a,b)},e.prototype={eql:function(a){return this.contains(a.anchor)&&this.isParallelTo(a)},dup:function(){return e.create(this.anchor,this.normal)},translate:function(a){var b=a.elements||a;return e.create([this.anchor.elements[0]+b[0],this.anchor.elements[1]+b[1],this.anchor.elements[2]+(b[2]||0)],this.normal)},isParallelTo:function(a){var b;return a.normal?(b=this.normal.angleFrom(a.normal),Math.abs(b)<=f.precision||Math.abs(Math.PI-b)<=f.precision):a.direction?this.normal.isPerpendicularTo(a.direction):null},isPerpendicularTo:function(a){var b=this.normal.angleFrom(a.normal);return Math.abs(Math.PI/2-b)<=f.precision},distanceFrom:function(a){if(this.intersects(a)||this.contains(a))return 0;if(a.anchor){var b=this.anchor.elements,c=a.anchor.elements,d=this.normal.elements;return Math.abs((b[0]-c[0])*d[0]+(b[1]-c[1])*d[1]+(b[2]-c[2])*d[2])}var e=a.elements||a,b=this.anchor.elements,d=this.normal.elements;return Math.abs((b[0]-e[0])*d[0]+(b[1]-e[1])*d[1]+(b[2]-(e[2]||0))*d[2])},contains:function(a){if(a.normal)return null;if(a.direction)return this.contains(a.anchor)&&this.contains(a.anchor.add(a.direction));var b=a.elements||a,c=this.anchor.elements,d=this.normal.elements,e=Math.abs(d[0]*(c[0]-b[0])+d[1]*(c[1]-b[1])+d[2]*(c[2]-(b[2]||0)));return e<=f.precision},intersects:function(a){return"undefined"==typeof a.direction&&"undefined"==typeof a.normal?null:!this.isParallelTo(a)},intersectionWith:function(a){if(!this.intersects(a))return null;if(a.direction){var e=a.anchor.elements,f=a.direction.elements,g=this.anchor.elements,h=this.normal.elements,i=(h[0]*(g[0]-e[0])+h[1]*(g[1]-e[1])+h[2]*(g[2]-e[2]))/(h[0]*f[0]+h[1]*f[1]+h[2]*f[2]);return b.create([e[0]+f[0]*i,e[1]+f[1]*i,e[2]+f[2]*i])}if(a.normal){for(var j=this.normal.cross(a.normal).toUnitVector(),h=this.normal.elements,e=this.anchor.elements,k=a.normal.elements,l=a.anchor.elements,m=c.Zero(2,2),n=0;m.isSingular();)n++,m=c.create([[h[n%3],h[(n+1)%3]],[k[n%3],k[(n+1)%3]]]);for(var o=m.inverse().elements,p=h[0]*e[0]+h[1]*e[1]+h[2]*e[2],q=k[0]*l[0]+k[1]*l[1]+k[2]*l[2],r=[o[0][0]*p+o[0][1]*q,o[1][0]*p+o[1][1]*q],s=[],t=1;3>=t;t++)s.push(n==t?0:r[(t+(5-n)%3)%3]);return d.create(s,j)}},pointClosestTo:function(a){var c=a.elements||a,d=this.anchor.elements,e=this.normal.elements,f=(d[0]-c[0])*e[0]+(d[1]-c[1])*e[1]+(d[2]-(c[2]||0))*e[2];return b.create([c[0]+e[0]*f,c[1]+e[1]*f,(c[2]||0)+e[2]*f])},rotate:function(a,b){var d=c.Rotation(a,b.direction).elements,f=b.pointClosestTo(this.anchor).elements,g=this.anchor.elements,h=this.normal.elements,i=f[0],j=f[1],k=f[2],l=g[0],m=g[1],n=g[2],o=l-i,p=m-j,q=n-k;return e.create([i+d[0][0]*o+d[0][1]*p+d[0][2]*q,j+d[1][0]*o+d[1][1]*p+d[1][2]*q,k+d[2][0]*o+d[2][1]*p+d[2][2]*q],[d[0][0]*h[0]+d[0][1]*h[1]+d[0][2]*h[2],d[1][0]*h[0]+d[1][1]*h[1]+d[1][2]*h[2],d[2][0]*h[0]+d[2][1]*h[1]+d[2][2]*h[2]])},reflectionIn:function(a){if(a.normal){var b=this.anchor.elements,c=this.normal.elements,d=b[0],f=b[1],g=b[2],h=c[0],i=c[1],j=c[2],k=this.anchor.reflectionIn(a).elements,l=d+h,m=f+i,n=g+j,o=a.pointClosestTo([l,m,n]).elements,p=[o[0]+(o[0]-l)-k[0],o[1]+(o[1]-m)-k[1],o[2]+(o[2]-n)-k[2]];return e.create(k,p)}if(a.direction)return this.rotate(Math.PI,a);var q=a.elements||a;return e.create(this.anchor.reflectionIn([q[0],q[1],q[2]||0]),this.normal)},setVectors:function(a,c,d){if(a=b.create(a),a=a.to3D(),null===a)return null;if(c=b.create(c),c=c.to3D(),null===c)return null;if("undefined"==typeof d)d=null;else if(d=b.create(d),d=d.to3D(),null===d)return null;var e,f,g=a.elements[0],h=a.elements[1],i=a.elements[2],j=c.elements[0],k=c.elements[1],l=c.elements[2];if(null!==d){var m=d.elements[0],n=d.elements[1],o=d.elements[2];if(e=b.create([(k-h)*(o-i)-(l-i)*(n-h),(l-i)*(m-g)-(j-g)*(o-i),(j-g)*(n-h)-(k-h)*(m-g)]),f=e.modulus(),0===f)return null;e=b.create([e.elements[0]/f,e.elements[1]/f,e.elements[2]/f])}else{if(f=Math.sqrt(j*j+k*k+l*l),0===f)return null;e=b.create([c.elements[0]/f,c.elements[1]/f,c.elements[2]/f])}return this.anchor=a,this.normal=e,this}},e.create=function(a,b,c){var d=new e;return d.setVectors(a,b,c)};var g=b.create,h=c.create,i=d.create,k=e.create;return f={version:"0.1.3",precision:1e-6,Vector:b,Matrix:c,Line:d,Plane:e,$V:g,$M:h,$L:i,$P:k}}]);