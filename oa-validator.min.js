"use strict";var _slicedToArray=function(){function a(a,b){var c=[],d=!0,e=!1,f=void 0;try{for(var g,h=a[Symbol.iterator]();!(d=(g=h.next()).done)&&(c.push(g.value),!b||c.length!==b);d=!0);}catch(i){e=!0,f=i}finally{try{!d&&h["return"]&&h["return"]()}finally{if(e)throw f}}return c}return function(b,c){if(Array.isArray(b))return b;if(Symbol.iterator in Object(b))return a(b,c);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_window=window,angular=_window.angular;angular.module("oaValidators",["oaUtil"]).constant("oaFloatPattern",function(){return"(^[0-9]+.([0-9]+)?([eE][-+][0-9]+)?$)|(^.[0-9]+([eE][-+][0-9]+)?$)|(^[0-9]+([eE][-+][0-9]+)?$)"}()).constant("oaIntPattern","^[0-9]+([eE][-+][0-9]+)?$").factory("oaFloatRegExp",["oaFloatPattern",function(a){return new RegExp(a)}]).factory("oaIntRegExp",["oaIntPattern",function(a){return new RegExp(a)}]).factory("oaNumber",["oaUtil","oaFloatPattern",function(a,b){function c(c,d,e){var f=this;e=Object.assign({key:!0,keys:!0,ngKey:!0,ngKeys:!0},e),f.sourceProperty=function(b,c,f,g,h,i){var j=a.ngKeySet(f,Object.assign({},e,{plural:g})),k=function(){var a;return j.ngKeys&&(a=c[j.ngKeys]),j.ng_keys&&!a&&(a=c[j.ng_keys]),j.keys&&!a&&(a=c[j.keys]),a},l=function(){var a;return j.ngKey&&(a=c[j.ngKey]),j.ng_key&&void 0==a&&(a=c[j.ng_key]),j.key&&void 0==a&&(a=c[j.key]),a},m=function(a){j.ngKey&&(c[j.ngKey]=a),j.ng_key&&(c[j.ng_key]=a),j.key&&(c[j.key]=a)};Object.defineProperty(b,"_"+f,{enumerable:!0,get:function(){var a=k(),b=l(),c=a&&void 0!=d?a[d]||b:b;return h?h(c):c},set:function(a){if(void 0!=a){i&&(a=i(a));var b=k();b&&void 0!=d?b[d]=a:m(a)}}})},f.specProperty=function(a,b,c,d,e,f){e||a.sourceProperty(a,b,c,d,f),Object.defineProperty(a,c+"Spec",{enumerable:!0,get:function(){return void 0!=a[c]}})},f.numberProperty=function(a,b,c,d,e,f,g){e?f||a.sourceProperty(a,b,c,d,g):a.specProperty(a,b,c,d,f,g),Object.defineProperty(a,c,{enumerable:!0,get:function(){return void 0!=a["_"+c]?parseFloat(a["_"+c]):void 0},set:function(b){a["_"+c]=void 0==b?b:b.toString()}}),Object.defineProperty(a,c+"Dec",{enumerable:!0,get:function(){var b=a["_"+c];if(void 0!=b)try{var d=new Decimal(b);return d}catch(e){}},set:function(b){a["_"+c]=void 0==b?b:b.toString()}})},f.genProperty=function(a,b,c,d,e,f,g){e?f||a.sourceProperty(a,b,c,d,g):a.specProperty(a,b,c,d,f,g),Object.defineProperty(a,c,{enumerable:!0,get:function(){return void 0!=a["_"+c]?a["_"+c]:void 0},set:function(b){a["_"+c]=void 0==b?b:b.toString()}})},f.isNumeric=function(a){return a&&a.match(b)},Object.defineProperty(f,"numeric",{get:function(){return f.valueSpec&&f.isNumeric(f._value)}}),Object.defineProperty(f,"_number",{get:function(){return isNaN(f.value)?f._basis:f.value.toString()}}),f.numberProperty(f,c,"number",null,!0,!0),f.isValidInterval=function(a){if(void 0==a)return{valid:!1};if("string"==typeof a){if(!a.length||!f.isNumeric(a))return{valid:!1};a=new Decimal(a)}else if("number"==typeof a){if(isNaN(a))return{valid:!1};a=new Decimal(a)}if(!f.stepSpec)return{valid:!0};var b={},c=a.sub(f.basis);return b.valid=c.mod(f.step).equals(0),b.valid?(b.previous=a.sub(f.step),b.closest=a,b.next=a.add(f.step)):(b.previous=c.div(f.step).floor().mul(f.step).add(f.basis),b.closest=c.div(f.step).round().mul(f.step).add(f.basis),b.next=c.div(f.step).ceil().mul(f.step).add(f.basis)),b},Object.defineProperty(f,"validInterval",{get:function(){return f.isValidInterval(f._value).valid}}),Object.defineProperty(f,"_previous",{get:function(){if(f.valueSpec&&f.numeric&&f.stepSpec){var a=f.valueDec.sub(f.basis);return(f.validInterval?f.valueDec.sub(f.step):a.div(f.step).floor().mul(f.step).add(f.basis)).toString()}}}),Object.defineProperty(f,"_next",{get:function(){if(f.valueSpec&&f.numeric&&f.stepSpec){var a=f.valueDec.sub(f.basis);return(f.validInterval?f.valueDec.add(f.step):a.div(f.step).ceil().mul(f.step).add(f.basis)).toString()}}}),Object.defineProperty(f,"_closest",{get:function(){if(f.valueSpec&&f.numeric&&f.stepSpec){var a=f.valueDec.sub(f.basis);return(f.validInterval?f._value:a.div(f.step).round().mul(f.step).add(f.basis)).toString()}}}),f.numberProperty(f,c,"previous",null,!0,!0),f.numberProperty(f,c,"next",null,!0,!0),f.numberProperty(f,c,"closest",null,!0,!0),f.numberProperty(f,c,"value"),f.numberProperty(f,c,"min"),f.numberProperty(f,c,"max"),f.numberProperty(f,c,"step"),f.numberProperty(f,c,"basis","bases",!1,!1,function(a){return a||f.min||f.max||0}),f.genProperty(f,c,"required"),f.ensureMin=function(){if(f.numeric&&f.minSpec){var a;f.valueDec.lt(f.min)&&(a=f.isValidInterval(f.min),a.valid?f.value=a.closest:f.value=a.next)}},f.ensureMax=function(){if(f.numeric&&f.maxSpec){var a;f.valueDec.gt(f.max)&&(a=f.isValidInterval(f.max),a.valid?f.value=a.closest:f.value=a.previous)}},f.ensureNumeric=function(){f._value;f.numeric||(f.value=f.number)},f.ensureStep=function(){if(f.numeric&&f.stepSpec){var a=f._value;f.validInterval||(f.value=f.closest,f.ensureMin(),f.ensureMax()),console.log({old:a,"new":f._value,closest:f._closest})}},f.ensureValid=function(){f.ensureNumeric(),f.ensureMin(),f.ensureMax(),f.ensureStep()},f.decrement=function(){f.numeric&&f.stepSpec&&(f.value=f.previous,f.ensureMin())},f.increment=function(){f.numeric&&f.stepSpec&&(f.value=f.next,f.ensureMax())},f.toJSON=function(){var a={};return Object.keys(f).forEach(function(b){a[b]=f[b]}),a}}return c}]).directive("oaNumeric",["oaFloatPattern","oaNumber",function(a,b){function c(a,b,c,d){var e=_slicedToArray(d,2),f=e[0],g=e[1];f.$scope=a,f.$ngModel=g,a.number=f,console.log(f.toJSON()),window["oaNumber_"+g.$name]=f,g.$validators.oaNumeric=function(b,c){if(f.value=c,!c||!c.length)return!0;if(!f.numeric){if(void 0!=a.ensureValid)f.ensureValid();else{if(void 0==a.ensureNumeric)return!1;f.ensureNumeric()}g.$setViewValue(f._value),g.$validate(),g.$render()}return!0},g.$validators.min=function(b,c){if(f.value=c,!f.minSpec)return!0;if(!c||!c.length||!f.numeric)return!0;if(f.minDec.gt(b)){if(void 0!=a.ensureValid)f.ensureValid();else{if(void 0==a.ensureMin)return!1;f.ensureMin()}g.$setViewValue(f._value),g.$validate(),g.$render()}return!0},g.$validators.max=function(b,c){if(f.value=c,!f.maxSpec)return!0;if(!c||!c.length||!f.numeric)return!0;if(f.maxDec.lt(b)){if(void 0!=a.ensureValid)f.ensureValid();else{if(void 0==a.ensureMax)return!1;f.ensureMax()}g.$setViewValue(f._value),g.$validate(),g.$render()}return!0},g.$validators.step=function(b,c){if(f.value=c,!f.stepSpec)return!0;if(!c||!c.length||!f.numeric)return!0;if(!f.validInterval){if(void 0!=a.ensureValid)f.ensureValid();else{if(void 0==a.ensureStep)return!1;f.ensureStep()}g.$setViewValue(f._value),g.$validate(),g.$render()}return!0},g.$validators.required=function(a,b){return f.value=b,f.requiredSpec?!f.required||!f.required.length||"false"===f.required||b&&b.length?!0:!1:!0}}return{restrict:"A",scope:{required:"@?",ngRequired:"=?",ensureValid:"@?",ensureNumeric:"@?",step:"@?",ngStep:"=?",ensureStep:"@?",basis:"@?",ngBasis:"=?",min:"@?",ngMin:"=?",ensureMin:"@?",max:"@?",ngMax:"=?",ensureMax:"@?",number:"=?"},require:["oaNumeric","ngModel"],controller:["$scope",b],link:c}}]);